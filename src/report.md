## Part 1. Инструмент **ipcalc**


1. ![Alt text](image/image-10.png)  
Устанавливаем инструмент ipcalc(sudo apt install ipcalc)<br>
<br>
<br>
<br>


2. ![ipcalc 192.167.38.54/13](image/image-11.png)  
- ввел команду ipcalc 192.167.38.54/13  
- адрес сети - 192.160.0.0/13<br>
<br>
<br>
<br>

3. ![ipcalc 255.255.255.0](image/image-0.png)  
    - ввел команду ipcalc 192.167.38.54/13  
    - 255.255.255.0 = префиксная 24  +
    - 255.255.255.0 = в двоичной 11111111.11111110.00000000.00000000 <br>
<br>
<br>
<br>

4. ![ipcalc /15](image/image-1.png)  
    - ввел команду ipcalc /15  
    - /15 = обычная 255.254.0.0
    - /15 = двоичная 11111111.11111110.00000000.00000000<br>
<br>
<br>
<br>  
  
5. 
    - 11111111.11111111.11111111.11110000 в десятичную систему это будет 255.255.255.240
    - 11111111.11111111.11111111.11110000 =  первые 28 бит отведены для сети, а оставшиеся 4 бита отведены для хостов, префикс /28<br>
<br>
<br>
<br>

6. ![ipcalc 12.167.38.4/8](image/image-2.png)  
    - ввел команду ipcalc  12.167.38.4/8<br>
    - Минимальный хост: 12.167.0.1
    - Максимальный хост: 12.167.255.254
<br>
<br>
<br>

7. ![ipcalc 12.167.38.4/16](image/image-3.png)  
    - Маска 11111111.11111111.00000000.00000000 это та же самая маска /16  
    - ввел команду ipcalc  12.167.38.4/16
    - Минимальный хост: 12.167.0.1
    - Максимальный хост: 12.167.255.254<br>
<br>
<br>
<br>

8. ![ipcalc 12.167.38.4/255.255.254.0](image/image-4.png)
    - ввел команду ipcalc  12.167.38.4/255.255.254.0
    - Минимальный хост: 12.167.38.1
    - Максимальный хост: 12.167.39.254<br>
<br>
<br>
<br>

9. ![ipcalc 12.167.38.4/4](image/image-5.png)
    - ввел команду ipcalc 12.167.38.4/4
    - Минимальный хост: 0.0.0.1
    - Максимальный хост: 15.255.255.254<br>
<br>
<br>
<br>

10. ![ipcalc 127.0.0.1/8](image/image-6.png)
    - 194.34.23.100 - этот ip не является частью диапозона, подключитсья невозможно
    - 127.0.0.2 - этот ip принадлжеит диапозону, подключение возможно
    - 127.1.0.1 - этот ip принадлжеит диапозону, подключение возможно
    - 128.0.0.1 - этот ip не является частью диапозона, подключитсья невозможно<br>
<br>
<br>
<br>

11. ![частные IP адреса](image/image-7.png)<br>
    - частные ip адреса
<br>
<br>
<br>

12. ![ipcalc частных ip](image/image-8.png)
    - ipcalc 3 ip адресов выше
    - 10.0.0.45 - частный
    - 134.43.0.2 - публичный
    - 192.168.4.2 - частный
    - 172.20.250.4 - частный
    - 172.0.2.1 - публичный
    - 192.172.0.1 - публичный
    - 172.68.0.2 - частный
    - 172.16.255.255 - частный
    - 10.10.10.10 - частный
    - 192.169.168.1 - публичный<br>
<br>
<br>
<br>

13. ![ipcalc 10.10.0.0/18](image/image-9.png)
- диапозон от 10.10.0.1 до  10.10.63.254
    - 10.0.0.1 - не входит в диапозон 
    - 10.10.0.2 - входит в диапозон
    - 10.10.10.10 - входит в диапозон
    - 10.10.100.1 - входит в диапозон
    - 10.10.1.255 - не входит в диапозон<br>
<br>
<br>
<br>

## Part 2. Статическая маршрутизация между двумя машинами

1. ![ip a -> ws1](image/image-12.png)<br>
2. ![ip a -> ws2](image/image-13.png)<br>
    - ip a для ws1 и ws2
<br>
<br>
<br>


3. ![ws1](image/image-14.png)<br>
    - Измененный конфиг для ws1<br>
<br>
<br>
<br>

4. ![ws2](image/image-16.png)<br>
    - Измененный конфиг для ws2<br>
<br>
<br>
<br>

5. ![sudo netplan apply](image/image-15.png)<br>
    - sudo netplan apply для ws1 и ws2<br>
<br>
<br>
<br>


6. ![ws1 -> sudo ip r add 172.24.116.8 dev enp0s3](image/image-18.png)<br>
    - ввёл команду sudo ip r add 172.24.116.8 dev enp0s3, после чего успешно пропинговал ws2<br>
<br>
<br>
<br>


7. ![ws2 -> sudo ip r add 192.168.100.10 dev enp0s3 ](image/image-17.png)<br>
    - ввёл команду sudo ip r add 192.168.100.10 dev enp0s3, после чего успешно пропинговал ws1<br>
<br>
<br>
<br>



8. ![конфигурации netplan для ws1 и ws2](image/image-19.png)<br>
    - изменил конфигурационный файл для ws1 и ws2, добавив статическую маршрутизацию с помощью routes<br>
<br>
<br>
<br>



9. ![пинги от машины к машине](image/image-20.png)<br>
    - пинг от ws1 -> ws2 и пинг от ws2 -> ws1<br>
<br>
<br>
<br>

## Part 3. Утилита **iperf3**

1. Перевод:
    - 8 Mbps = 1 MB/s
    - 100 MB/s = 800 Kbsp
    - 1 Gbps = 1000 Mbps<br>
<br>
<br>
<br>

2. ![установка утилиты iperf3](image/image-22.png)
    - sudo apt install iperf3<br>
<br>
<br>
<br>

3. ![ws2 выбираем в качетсве сервера,а ws1 в качестве клиента](image/image-21.png)
    - на ws2 iperf3 -s -f M(для отображения в МегаБайтах)
    - на ws1 iperf3 -c 172.24.116.8(для подключения)<br>
<br>
<br>
<br>


4. ![ws1 выбираем в качестве сервера, а ws2 в качетсве клиента](image/image-23.png)
    - на ws1 iperf3 -s -f M(для отображения в МегаБайтах)
    - на ws2 iperf3 -c 192.168.100.10(для подключения)<br>
<br>
<br>
<br>

## Part 4. Сетевой экран

1. ![файл для ws1](image/image-24.png)
2. ![файл для ws2](image/image-25.png)
    - F - очищает все правила и цепочки 
    - X - удаляет пользовательские цепочки
    - A - добовляет правило в конец указанной цепочки
    - p - указывает протокол для правила
    - dport - указывает порт для трафика
    - j - цель для правила 
    - icmp-type - для указания типо ICMP-сообщения<br>
<br>
<br>
<br>

3. ![вызов команды](image/image-26.png)
    - вызов команды firewall.sh
<br>
<br>
<br>

4. ![iptables -L](image/image-27.png)
    - вызов команды iptables -L для проверки.<br>
<br>
<br>
<br>

5. На ws1 в начале применяется запрещающее правило (DROP), а затем разрешающее правило (ACCEPT), сначала блокируется весь трафик, а затем разрешается только определенный, весь трафик будет отвергнут, если не соответствует определенным правилам.

6. На ws2 в начале применяется разрешающее правило (ACCEPT), а затем запрещающее правило (DROP), сначала разрешается весь трафик, а затем блокируется только определенный , весь трафик будет принят, если не соответствует определенным правилам.<br>
<br>
<br>
<br>

7. ![ws2 не пингует ws1](image/image-28.png)
    - проверяем пинг на ws2 к ws1

8. ![nmap на ws1 и ws2](image/image-29.png)
    - утилитой nmap проверяем Host is up<br>
<br>
<br>
<br>

## Part 5. Статическая маршрутизация сети

sudo systemctl restart systemd-networkd - для перезапуска сервиса сети

1. ![ws11](image/image-30.png)
    - конфиг для ws11
2. ![ws21](image/image-31.png)
    - конфиг для ws21
3. ![ws22](image/image-32.png)
    - конфиг для ws22
4. ![r1](image/image-33.png)
    - конфиг для r1
5. ![r2](image/image-34.png)
    - конфиг для r2
6. ![ip -4 a](image/image-35.png)
    - ip -4 a для всех машин
7. ![ping ws21 -> ws22](image/image-36.png)
    - ping ws22 с ws21
8. ![ping ws11 -> r1](image/image-37.png)
    - ping r1 c ws11
<br>
<br>
<br>

9. ![sysctl -w net.ipv4.ip_forward=1](image/image-38.png)
    - команда на r1 и r2

10. ![для r1](image/image-39.png)
    - убрал # для ipv4
11. ![для r2](image/image-40.png)
    - убрал # для ipv4<br>
<br>
<br>
<br>

12. ![конфиги для ws11,21,22](image/image-41.png)
    - измененный конфиги 
13. ![ip r для ws11,21,22](image/image-42.png)
    - ip r для всех машин
14. ![пинг с ws11 к r2](image/image-43.png)
    - tcpdump -tn -i enp0s9<br>
<br>
<br>
<br>

15. ![конфигурации для r1 и r2](image/image-44.png)
    - измененные конфигурации 

16. ![ip r](image/image-45.png)
    - ip r для r1 и r2

17. ![ip r list 10.10.0.0/18 и ip r list 0.0.0.0/0](image/image-46.png)
    - Маршрут 10.10.0.0/18 является более конкретным, чем 0.0.0.0/0, т.к охватывает более узкий диапозон, и поэтому маршрут по умолочанию не будет использоваться, так как есть более точный маршрут для этой сети. Это позволяет более точно маршрутизировать пакеты.<br>
<br>
<br>
<br>

18. ![Alt text](image/image-47.png)
    - tcpdump -tnv -i enp0s8
19. ![Alt text](image/image-48.png)
    - traceroute 10.20.0.10
20. Утилита traceroute использует принцип работы сетевого протокола ICMP (Internet Control Message Protocol) для построения пути от отправителя до получателя. Она отправляет серию пакетов с увеличивающимся значением TTL (Time To Live) и отслеживает ответы от промежуточных маршрутизаторов на пути к целевому хосту.<br>
<br>
<br>
<br>

21. ![Alt text](image/image-49.png)
    - на r1 sudo tcpdump -n -i enp0s8 icmp
    - на ws11 ping -c 1 10.30.0.111
    - ICMP -  сетевой протокол, в основном ICMP используется для передачи сообщений об ошибках и других исключительных ситуациях, возникших при передаче данных.
<br>
<br>
<br>

## Part 6. Динамическая настройка IP с помощью **DHCP**

1. ![Alt text](image/image-50.png)
    - изменил конфигурационый файл 

2. ![Alt text](image/image-51.png)
    - изменил resolv.conf

3. ![Alt text](image/image-52.png)
    - перезапуск службы DHCP systemctl restart isc-dhcp-server

4. ![Alt text](image/image-53.png)
    - на ws21: ip a и пинг ws21 -> ws22

5. ![Alt text](image/image-54.png)
    - изменил конфиг для ws11

6. ![Alt text](image/image-55.png)
    - конфиг для r1
    
7. ![Alt text](image/image-56.png)
    - изменил файл resolf для r1

8. ![Alt text](image/image-57.png)
    - перезапустил службу

9. ![Alt text](image/image-58.png)
    - на ws21: ip a и пинг ws21 -> ws22

10. ![Alt text](image/image-59.png)
    - ip a до обновления

11. ![Alt text](image/image-60.png)
    - освобождаем IP-адрес DHCP-клиента с помощью команды sudo dhclient -r и получаем новый IP-адрес с помощью DHCP с помощью команды sudo dhclient

12. ![Alt text](image/image-61.png)
    - ip a после обновления

13. 
    - Настройка конфигурации службы DHCP (адрес маршрутизатора по-умолчанию, DNS-сервер, адрес внутренней сети, привязка к MAC-адресу)
    - Клиент протокола динамической конфигурации хоста (команда dhclient) для обновления или освобождения IP-адреса

## Part 7. **NAT**

1. ![alt text](image/image-62.png)
    - изменил конфиги на ws22 и r1

2. ![alt text](image/image-63.png)
    - запустил веб-сервер апачи2

3. ![alt text](image/image-64.png)
    - добовляем в firewall правила по заданию

4. ![alt text](image/image-65.png)
    - запускаем firewall 

5. ![alt text](image/image-66.png)
    - с r1 не пингуется ws22

6. ![alt text](image/image-67.png)
    - Добавили в firewall правило для обработки входящих icmp пакетов

7. ![alt text](image/image-68.png) 
    - запускаем файл командами

8. ![alt text](image/image-69.png)
    - с r1 пингуется ws22 

9. ![alt text](image/image-70.png)
    - добовляем в firewall следущие правила

10. ![alt text](image/image-71.png)
    - запускаем firewall

11. ![alt text](image/image-72.png)
    - на ws22 telnet 10.10.0.1 80

12. ![alt text](image/image-73.png)
    - на r1 telnet 10.20.0.20 80



## Part 8. Дополнительно. Знакомство с **SSH Tunnels**

1. ![alt text](image/image-74.png)
    - firewall на r2

2. ![alt text](image/image-75.png)
    - на ws22 изменили конфигурацию apache2

3. ![alt text](image/image-76.png)
    - с помощью команды ssh -L 8080:localhost:80 10.20.0.20 подключаемся к ws22 с ws21

4. ![alt text](image/image-77.png)
    - физически находясь на ws21, а в терминале на ws22, проверяем через telnet сработало ли подключение

5. ![alt text](image/image-78.png)
    - с ws11 подключаемся к ws22 ssh -R 8080:localhost:80 10.20.0.20

6. ![alt text](image/image-79.png)
    - проверяем через telnet сработало ли подключение